\hypertarget{namespaceLibMap}{}\doxysection{Lib\+Map Namespace Reference}
\label{namespaceLibMap}\index{LibMap@{LibMap}}


Module to remap the scintillator.  


\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{classLibMap_1_1CalibrationDatabase}{Calibration\+Database}}
\begin{DoxyCompactList}\small\item\em Class with with the database of parameter to align the scintillator. \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classLibMap_1_1CalParams}{Cal\+Params}}
\begin{DoxyCompactList}\small\item\em Class with the information to relate points in the camera sensor with points in the scintillator. \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classLibMap_1_1Scintillator}{Scintillator}}
\begin{DoxyCompactList}\small\item\em Class with the scintillator information. \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classLibMap_1_1StrikeMap}{Strike\+Map}}
\begin{DoxyCompactList}\small\item\em Class with the information of the strike map. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \mbox{\hyperlink{namespaceLibMap_ac38fcf0ae779d053833f37492ef245c8}{transform\+\_\+to\+\_\+pixel}} (x, y, grid\+\_\+param)
\begin{DoxyCompactList}\small\item\em Transform from X,Y coordinates (points along the scintillator) to pixels in the camera. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespaceLibMap_a38dbf93de245aba1e6bda775b10bedfa}{get\+\_\+points}} (fig, scintillator, bool plt\+\_\+flag=True, int npoints=3)
\begin{DoxyCompactList}\small\item\em Get the points of the scintillator via ginput method. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespaceLibMap_abeb9b36f78beec2f76470080bde20e4d}{calculate\+\_\+transformation\+\_\+factors}} (scintillator, fig, bool plt\+\_\+flag=True)
\begin{DoxyCompactList}\small\item\em Calculate the transformation factor to align the strike map with the camera sensor. \end{DoxyCompactList}\item 
def \mbox{\hyperlink{namespaceLibMap_a15b8e38e11c7ebf83daf570394cd1b78}{remap}} (smap, timing=True)
\begin{DoxyCompactList}\small\item\em Remap a frame. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Module to remap the scintillator. 

It contains the routines to load and aling the strike maps, as well as perform the remapping 

\doxysubsection{Function Documentation}
\mbox{\Hypertarget{namespaceLibMap_abeb9b36f78beec2f76470080bde20e4d}\label{namespaceLibMap_abeb9b36f78beec2f76470080bde20e4d}} 
\index{LibMap@{LibMap}!calculate\_transformation\_factors@{calculate\_transformation\_factors}}
\index{calculate\_transformation\_factors@{calculate\_transformation\_factors}!LibMap@{LibMap}}
\doxysubsubsection{\texorpdfstring{calculate\_transformation\_factors()}{calculate\_transformation\_factors()}}
{\footnotesize\ttfamily def Lib\+Map.\+calculate\+\_\+transformation\+\_\+factors (\begin{DoxyParamCaption}\item[{}]{scintillator,  }\item[{}]{fig,  }\item[{bool }]{plt\+\_\+flag = {\ttfamily True} }\end{DoxyParamCaption})}



Calculate the transformation factor to align the strike map with the camera sensor. 

Jose Rueda\+: \href{mailto:jose.rueda@ipp.mpg.de}{\texttt{ jose.\+rueda@ipp.\+mpg.\+de}}


\begin{DoxyParams}{Parameters}
{\em scintillator} & \mbox{\hyperlink{classLibMap_1_1Scintillator}{Scintillator}} object \\
\hline
{\em fig} & figure where the calibration image is drawn \\
\hline
{\em plt\+\_\+flag} & flag to plot the selected points to align the scintillator \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
xmag\+: magnification factor in the x direction to align strike map 

mag\+: magnification factor in the y direction to align the strike map 

alpha\+: rotation angle to orientate the strike map 

offset\+: offset to place the strike map 
\end{DoxyReturn}
\begin{DoxyRefDesc}{Todo}
\item[\mbox{\hyperlink{todo__todo000003}{Todo}}]check with a non inverted png if the minus I included to align the scintillator is needed or not\end{DoxyRefDesc}


Definition at line 142 of file Lib\+Map.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{142 \textcolor{keyword}{def }\mbox{\hyperlink{namespaceLibMap_abeb9b36f78beec2f76470080bde20e4d}{calculate\_transformation\_factors}}(scintillator, fig, plt\_flag: bool = \textcolor{keyword}{True}):}
\DoxyCodeLine{143     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{144 \textcolor{stringliteral}{    Calculate the transformation factor to align the strike map with the}}
\DoxyCodeLine{145 \textcolor{stringliteral}{    camera sensor}}
\DoxyCodeLine{146 \textcolor{stringliteral}{}}
\DoxyCodeLine{147 \textcolor{stringliteral}{    Jose Rueda: jose.rueda@ipp.mpg.de}}
\DoxyCodeLine{148 \textcolor{stringliteral}{}}
\DoxyCodeLine{149 \textcolor{stringliteral}{    @param scintillator: Scintillator object}}
\DoxyCodeLine{150 \textcolor{stringliteral}{    @param fig: figure where the calibration image is drawn}}
\DoxyCodeLine{151 \textcolor{stringliteral}{    @param plt\_flag: flag to plot the selected points to align the scintillator}}
\DoxyCodeLine{152 \textcolor{stringliteral}{    @return xmag: magnification factor in the x direction to align strike map}}
\DoxyCodeLine{153 \textcolor{stringliteral}{    @return mag: magnification factor in the y direction to align the strike map}}
\DoxyCodeLine{154 \textcolor{stringliteral}{    @return alpha: rotation angle to orientate the strike map}}
\DoxyCodeLine{155 \textcolor{stringliteral}{    @return offset: offset to place the strike map}}
\DoxyCodeLine{156 \textcolor{stringliteral}{    @todo check with a non inverted png if the minus I included to align the}}
\DoxyCodeLine{157 \textcolor{stringliteral}{    scintillator is needed or not}}
\DoxyCodeLine{158 \textcolor{stringliteral}{    "{}"{}"{}}}
\DoxyCodeLine{159 }
\DoxyCodeLine{160     \textcolor{comment}{\# Plot the scintillator}}
\DoxyCodeLine{161     fig\_scint, ax\_scint = plt.subplots()}
\DoxyCodeLine{162     scintillator.plot\_real(ax\_scint)}
\DoxyCodeLine{163 }
\DoxyCodeLine{164     \textcolor{comment}{\# Select the points in the scintillator}}
\DoxyCodeLine{165     index = \mbox{\hyperlink{namespaceLibMap_a38dbf93de245aba1e6bda775b10bedfa}{get\_points}}(fig\_scint, scintillator, plt\_flag)}
\DoxyCodeLine{166     npoints = index.size}
\DoxyCodeLine{167     print(npoints)}
\DoxyCodeLine{168     \textcolor{comment}{\# Select the corresponding points in the reference frame}}
\DoxyCodeLine{169     print(\textcolor{stringliteral}{'Select the points on the calibration frame, in the same order as '}}
\DoxyCodeLine{170           \textcolor{stringliteral}{'before'})}
\DoxyCodeLine{171     points\_frame = fig.ginput(npoints)}
\DoxyCodeLine{172     print(points\_frame)}
\DoxyCodeLine{173     \textcolor{comment}{\# Define the vectors which will give us the reference}}
\DoxyCodeLine{174     v21\_real = np.array((scintillator.coord\_real[index[0], 1] -\/}
\DoxyCodeLine{175                          scintillator.coord\_real[index[1], 1],}
\DoxyCodeLine{176                          scintillator.coord\_real[index[0], 2] -\/}
\DoxyCodeLine{177                          scintillator.coord\_real[index[1], 2], 0))}
\DoxyCodeLine{178     v23\_real = np.array((scintillator.coord\_real[index[2], 1] -\/}
\DoxyCodeLine{179                          scintillator.coord\_real[index[1], 1],}
\DoxyCodeLine{180                          scintillator.coord\_real[index[2], 2] -\/}
\DoxyCodeLine{181                          scintillator.coord\_real[index[1], 2], 0))}
\DoxyCodeLine{182     print(v21\_real)}
\DoxyCodeLine{183     print(points\_frame[0][0])}
\DoxyCodeLine{184     a = np.array((points\_frame[0][0], points\_frame[0][1], 0))}
\DoxyCodeLine{185     print(a)}
\DoxyCodeLine{186     print(a.shape)}
\DoxyCodeLine{187 }
\DoxyCodeLine{188     v21\_pix = np.array([points\_frame[0][0], points\_frame[0][1], 0]) -\/ \(\backslash\)}
\DoxyCodeLine{189                   np.array([points\_frame[1][0], points\_frame[1][1], 0])}
\DoxyCodeLine{190 }
\DoxyCodeLine{191     v23\_pix = np.array([points\_frame[2][0], points\_frame[2][1], 0]) -\/ \(\backslash\)}
\DoxyCodeLine{192                   np.array([points\_frame[1][0], points\_frame[1][1], 0])}
\DoxyCodeLine{193 }
\DoxyCodeLine{194     \textcolor{comment}{\# See if an inversion of one of the axis is needed or not.}}
\DoxyCodeLine{195     normal\_real = np.cross(v21\_real, v23\_real)}
\DoxyCodeLine{196     print(normal\_real)}
\DoxyCodeLine{197     normal\_pix = np.cross(v21\_pix, v23\_pix)}
\DoxyCodeLine{198     print(normal\_pix)}
\DoxyCodeLine{199     \textcolor{comment}{\# If the normals has opposite signs, an inversion must be done}}
\DoxyCodeLine{200     \textcolor{keywordflow}{if} normal\_pix[2] * normal\_real[2] < 0:}
\DoxyCodeLine{201         sign = -\/1.0}
\DoxyCodeLine{202     \textcolor{keywordflow}{else}:}
\DoxyCodeLine{203         sign = 1.0}
\DoxyCodeLine{204     \textcolor{comment}{\# With this sign in mind, now we can proceed with the calculation of the}}
\DoxyCodeLine{205     \textcolor{comment}{\# ratio and the gyration angle}}
\DoxyCodeLine{206     \textcolor{comment}{\# Initialise the variables}}
\DoxyCodeLine{207     alpha = 0  \textcolor{comment}{\# Rotation to be applied}}
\DoxyCodeLine{208     mag = 0  \textcolor{comment}{\# Magnification}}
\DoxyCodeLine{209     offset = np.zeros(2)}
\DoxyCodeLine{210     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(npoints):}
\DoxyCodeLine{211         \textcolor{comment}{\# We will use the pair formed by each point and the following,}}
\DoxyCodeLine{212         \textcolor{comment}{\# for the case of the last point in the list, just take the next one}}
\DoxyCodeLine{213         i2 = i + 1}
\DoxyCodeLine{214         \textcolor{keywordflow}{if} i2 == npoints:}
\DoxyCodeLine{215             i2 = 0}
\DoxyCodeLine{216         \textcolor{comment}{\# Distance in the real scintillator}}
\DoxyCodeLine{217         d\_real = np.sqrt((scintillator.coord\_real[index[i], 2] -\/}
\DoxyCodeLine{218                           scintillator.coord\_real[index[i2], 2]) ** 2 +}
\DoxyCodeLine{219                          (scintillator.coord\_real[index[i], 1] -\/}
\DoxyCodeLine{220                           scintillator.coord\_real[index[i2], 1]) ** 2)}
\DoxyCodeLine{221         \textcolor{comment}{\# Distance in the sensor}}
\DoxyCodeLine{222         dummy = np.array(points\_frame[i]) -\/ np.array(points\_frame[i2])}
\DoxyCodeLine{223         d\_pix = np.sqrt(dummy[1] ** 2 + dummy[0] ** 2)}
\DoxyCodeLine{224         \textcolor{comment}{\# Cumulate the magnification factor (we will normalise at the end)}}
\DoxyCodeLine{225         mag = mag + d\_pix / d\_real}
\DoxyCodeLine{226         \textcolor{comment}{\# Calculate the angles}}
\DoxyCodeLine{227         alpha\_r = -\/  math.atan2(scintillator.coord\_real[index[i], 2] -\/}
\DoxyCodeLine{228                                 scintillator.coord\_real[index[i2], 2],}
\DoxyCodeLine{229                                 sign * scintillator.coord\_real[index[i], 1] -\/}
\DoxyCodeLine{230                                 sign * scintillator.coord\_real[index[i2], 1])}
\DoxyCodeLine{231         \textcolor{comment}{\# If alpha == 180, it can be also -\/180, atan2 fails here, check which}}
\DoxyCodeLine{232         \textcolor{comment}{\# one is the case}}
\DoxyCodeLine{233         \textcolor{keywordflow}{if} int(alpha\_r * 180 / np.pi) == 180:}
\DoxyCodeLine{234             print(\textcolor{stringliteral}{'Correcting angle'})}
\DoxyCodeLine{235             \textcolor{keywordflow}{if} scintillator.coord\_real[index[i2], 1] > scintillator.coord\_real[}
\DoxyCodeLine{236                                                         index[i], 1]:}
\DoxyCodeLine{237                 alpha\_r = -\/ alpha\_r}
\DoxyCodeLine{238 }
\DoxyCodeLine{239         alpha\_px = -\/ math.atan2(dummy[1], dummy[0])}
\DoxyCodeLine{240         alpha = alpha + (alpha\_px -\/ alpha\_r)}
\DoxyCodeLine{241         \textcolor{comment}{\# Transform the coordinate to estimate the offset}}
\DoxyCodeLine{242         x\_new = (scintillator.coord\_real[index[i], 1] *}
\DoxyCodeLine{243                  math.cos(alpha\_px -\/ alpha\_r) -\/}
\DoxyCodeLine{244                  scintillator.coord\_real[index[i], 2] *}
\DoxyCodeLine{245                  math.sin(alpha\_px -\/ alpha\_r)) * d\_pix / d\_real * sign}
\DoxyCodeLine{246         y\_new = (scintillator.coord\_real[index[i], 1] *}
\DoxyCodeLine{247                  math.sin(alpha\_px -\/ alpha\_r) +}
\DoxyCodeLine{248                  scintillator.coord\_real[index[i], 2] *}
\DoxyCodeLine{249                  math.cos(alpha\_px -\/ alpha\_r)) * d\_pix / d\_real}
\DoxyCodeLine{250         offset = offset + np.array(points\_frame[i]) -\/ np.array((x\_new, y\_new))}
\DoxyCodeLine{251         \textcolor{comment}{\# print(alpha\_px*180/np.pi, alpha\_real*180/np.pi)}}
\DoxyCodeLine{252         \textcolor{comment}{\# print((alpha\_px-\/alpha\_real)*180/np.pi)}}
\DoxyCodeLine{253     \textcolor{comment}{\# Normalise magnification and angle}}
\DoxyCodeLine{254     mag = mag / npoints}
\DoxyCodeLine{255     xmag = sign * mag}
\DoxyCodeLine{256     alpha = alpha / npoints * 180 / np.pi}
\DoxyCodeLine{257     offset = offset / npoints}
\DoxyCodeLine{258     \textcolor{keywordflow}{return} xmag, mag, alpha, offset[0], offset[1]}
\DoxyCodeLine{259 }
\DoxyCodeLine{260 }

\end{DoxyCode}
\mbox{\Hypertarget{namespaceLibMap_a38dbf93de245aba1e6bda775b10bedfa}\label{namespaceLibMap_a38dbf93de245aba1e6bda775b10bedfa}} 
\index{LibMap@{LibMap}!get\_points@{get\_points}}
\index{get\_points@{get\_points}!LibMap@{LibMap}}
\doxysubsubsection{\texorpdfstring{get\_points()}{get\_points()}}
{\footnotesize\ttfamily def Lib\+Map.\+get\+\_\+points (\begin{DoxyParamCaption}\item[{}]{fig,  }\item[{}]{scintillator,  }\item[{bool }]{plt\+\_\+flag = {\ttfamily True},  }\item[{int }]{npoints = {\ttfamily 3} }\end{DoxyParamCaption})}



Get the points of the scintillator via ginput method. 

Jose Rueda\+: \href{mailto:jose.rueda@ipp.mpg.de}{\texttt{ jose.\+rueda@ipp.\+mpg.\+de}}


\begin{DoxyParams}{Parameters}
{\em fig} & Axis where the scintillator is drawn \\
\hline
{\em scintillator} & \mbox{\hyperlink{classLibMap_1_1Scintillator}{Scintillator}} object \\
\hline
{\em plt\+\_\+flag} & flag to plot \\
\hline
{\em npoints} & number of points in the selection \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
index\+: array with the index of each point, to be located in the scintillator.\+coord\+\_\+real 
\end{DoxyReturn}


Definition at line 39 of file Lib\+Map.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{39 \textcolor{keyword}{def }\mbox{\hyperlink{namespaceLibMap_a38dbf93de245aba1e6bda775b10bedfa}{get\_points}}(fig, scintillator, plt\_flag: bool = \textcolor{keyword}{True}, npoints: int = 3):}
\DoxyCodeLine{40     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{41 \textcolor{stringliteral}{    Get the points of the scintillator via ginput method}}
\DoxyCodeLine{42 \textcolor{stringliteral}{}}
\DoxyCodeLine{43 \textcolor{stringliteral}{    Jose Rueda: jose.rueda@ipp.mpg.de}}
\DoxyCodeLine{44 \textcolor{stringliteral}{}}
\DoxyCodeLine{45 \textcolor{stringliteral}{    @param fig: Axis where the scintillator is drawn}}
\DoxyCodeLine{46 \textcolor{stringliteral}{    @param scintillator: Scintillator object}}
\DoxyCodeLine{47 \textcolor{stringliteral}{    @param plt\_flag: flag to plot}}
\DoxyCodeLine{48 \textcolor{stringliteral}{    @param npoints: number of points in the selection}}
\DoxyCodeLine{49 \textcolor{stringliteral}{    @return index: array with the index of each point, to be located in the}}
\DoxyCodeLine{50 \textcolor{stringliteral}{    scintillator.coord\_real}}
\DoxyCodeLine{51 \textcolor{stringliteral}{    "{}"{}"{}}}
\DoxyCodeLine{52     print(\textcolor{stringliteral}{'Select the points in the scintillator'})}
\DoxyCodeLine{53     points = fig.ginput(npoints)}
\DoxyCodeLine{54     index = np.zeros(npoints, dtype=int)}
\DoxyCodeLine{55     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(npoints):}
\DoxyCodeLine{56         relative\_pos = scintillator.coord\_real[:, 1:3] -\/ points[i]}
\DoxyCodeLine{57         \textcolor{comment}{\# print(relative\_pos)}}
\DoxyCodeLine{58         index[i] = int(}
\DoxyCodeLine{59             np.argmin(relative\_pos[:, 1] ** 2 + relative\_pos[:, 0] ** 2))}
\DoxyCodeLine{60         \textcolor{comment}{\# print(index[i])}}
\DoxyCodeLine{61         \textcolor{keywordflow}{if} plt\_flag:}
\DoxyCodeLine{62             plt.plot(scintillator.coord\_real[index[i], 1],}
\DoxyCodeLine{63                      scintillator.coord\_real[index[i], 2], \textcolor{stringliteral}{'o'})}
\DoxyCodeLine{64             plt.text(scintillator.coord\_real[index[i], 1],}
\DoxyCodeLine{65                      scintillator.coord\_real[index[i], 2], str(i + 1))}
\DoxyCodeLine{66     \textcolor{keywordflow}{return} index}
\DoxyCodeLine{67 }
\DoxyCodeLine{68 }
\DoxyCodeLine{69 \textcolor{comment}{\# def transformation\_factors(index, scintillator, fig): DEPRECATED}}
\DoxyCodeLine{70 \textcolor{comment}{\#     "{}"{}"{}}}
\DoxyCodeLine{71 \textcolor{comment}{\#     Calculate the factor to translate from points in the scintillator to}}
\DoxyCodeLine{72 \textcolor{comment}{\#     pixels in the camera}}
\DoxyCodeLine{73 }
\DoxyCodeLine{74 \textcolor{comment}{\#     Jose Rueda: jose.rueda@ipp.mpg.de}}
\DoxyCodeLine{75 }
\DoxyCodeLine{76 \textcolor{comment}{\#     @param index: index array generated by get\_points()}}
\DoxyCodeLine{77 \textcolor{comment}{\#     @param scintillator: Scintillator object}}
\DoxyCodeLine{78 \textcolor{comment}{\#     @param fig: the figure where the calibration image is plotted}}
\DoxyCodeLine{79 \textcolor{comment}{\#     @return:}}
\DoxyCodeLine{80 \textcolor{comment}{\#     "{}"{}"{}}}
\DoxyCodeLine{81 \textcolor{comment}{\#     \# Number of points to be used}}
\DoxyCodeLine{82 \textcolor{comment}{\#     npoints = index.size}}
\DoxyCodeLine{83 \textcolor{comment}{\#     \# Point on the calibration frame}}
\DoxyCodeLine{84 \textcolor{comment}{\#     print('Select the points on the calibration frame, in the same order as '}}
\DoxyCodeLine{85 \textcolor{comment}{\#           'before')}}
\DoxyCodeLine{86 \textcolor{comment}{\#     points\_frame = fig.ginput(npoints)}}
\DoxyCodeLine{87 \textcolor{comment}{\#     \# Initialise the variables}}
\DoxyCodeLine{88 \textcolor{comment}{\#     alpha = 0  \# Rotation to be applied}}
\DoxyCodeLine{89 \textcolor{comment}{\#     mag = 0  \# Magnification}}
\DoxyCodeLine{90 \textcolor{comment}{\#     offset = np.zeros(2)}}
\DoxyCodeLine{91 \textcolor{comment}{\#     for i in range(npoints):}}
\DoxyCodeLine{92 \textcolor{comment}{\#         \# We will use the pair formed by each point and the following,}}
\DoxyCodeLine{93 \textcolor{comment}{\#         \# for the case of the last point in the list, just take the next one}}
\DoxyCodeLine{94 \textcolor{comment}{\#         i2 = i + 1}}
\DoxyCodeLine{95 \textcolor{comment}{\#         if i2 == npoints:}}
\DoxyCodeLine{96 \textcolor{comment}{\#             i2 = 0}}
\DoxyCodeLine{97 \textcolor{comment}{\#         \# Distance in the real scintillator}}
\DoxyCodeLine{98 \textcolor{comment}{\#         d\_real = np.sqrt((scintillator.coord\_real[index[i], 2] -\/}}
\DoxyCodeLine{99 \textcolor{comment}{\#                           scintillator.coord\_real[index[i2], 2]) ** 2 +}}
\DoxyCodeLine{100 \textcolor{comment}{\#                          (scintillator.coord\_real[index[i], 1] -\/}}
\DoxyCodeLine{101 \textcolor{comment}{\#                           scintillator.coord\_real[index[i2], 1]) ** 2)}}
\DoxyCodeLine{102 \textcolor{comment}{\#         \# Distance in the sensor}}
\DoxyCodeLine{103 \textcolor{comment}{\#         dummy = np.array(points\_frame[i]) -\/ np.array(points\_frame[i2])}}
\DoxyCodeLine{104 \textcolor{comment}{\#         d\_pix = np.sqrt(dummy[1] ** 2 + dummy[0] ** 2)}}
\DoxyCodeLine{105 \textcolor{comment}{\#         \# Cumulate the magnification factor (we will normalise at the end)}}
\DoxyCodeLine{106 \textcolor{comment}{\#         mag = mag + d\_pix / d\_real}}
\DoxyCodeLine{107 \textcolor{comment}{\#         \# Calculate the angles}}
\DoxyCodeLine{108 \textcolor{comment}{\#         alpha\_real = math.atan2(scintillator.coord\_real[index[i], 2] -\/}}
\DoxyCodeLine{109 \textcolor{comment}{\#                                 scintillator.coord\_real[index[i2], 2],}}
\DoxyCodeLine{110 \textcolor{comment}{\#                                 scintillator.coord\_real[index[i], 1] -\/}}
\DoxyCodeLine{111 \textcolor{comment}{\#                                 scintillator.coord\_real[index[i2], 1])}}
\DoxyCodeLine{112 \textcolor{comment}{\#         \# If alpha == 180, it can be also -\/180, atan2 fails here, check which}}
\DoxyCodeLine{113 \textcolor{comment}{\#         \# one is the case}}
\DoxyCodeLine{114 \textcolor{comment}{\#         if int(alpha\_real * 180 / np.pi) == 180:}}
\DoxyCodeLine{115 \textcolor{comment}{\#             print('Correcting angle')}}
\DoxyCodeLine{116 \textcolor{comment}{\#             if scintillator.coord\_real[index[i2],}}
\DoxyCodeLine{117 \textcolor{comment}{\#                                        1] > scintillator.coord\_real[}}
\DoxyCodeLine{118 \textcolor{comment}{\#                 index[i], 1]:}}
\DoxyCodeLine{119 \textcolor{comment}{\#                 alpha\_real = -\/ alpha\_real}}
\DoxyCodeLine{120 }
\DoxyCodeLine{121 \textcolor{comment}{\#         alpha\_px = math.atan2(dummy[1], dummy[0])}}
\DoxyCodeLine{122 \textcolor{comment}{\#         alpha = alpha + (alpha\_px -\/ alpha\_real)}}
\DoxyCodeLine{123 \textcolor{comment}{\#         \# Transform the coordinate to estimate the offset}}
\DoxyCodeLine{124 \textcolor{comment}{\#         x\_new = (scintillator.coord\_real[index[i], 1] *}}
\DoxyCodeLine{125 \textcolor{comment}{\#                  math.cos(alpha\_px -\/ alpha\_real) -\/}}
\DoxyCodeLine{126 \textcolor{comment}{\#                  scintillator.coord\_real[index[i], 2] *}}
\DoxyCodeLine{127 \textcolor{comment}{\#                  math.sin(alpha\_px -\/ alpha\_real)) * d\_pix / d\_real}}
\DoxyCodeLine{128 \textcolor{comment}{\#         y\_new = (scintillator.coord\_real[index[i], 1] *}}
\DoxyCodeLine{129 \textcolor{comment}{\#                  math.sin(alpha\_px -\/ alpha\_real) +}}
\DoxyCodeLine{130 \textcolor{comment}{\#                  scintillator.coord\_real[index[i], 2] *}}
\DoxyCodeLine{131 \textcolor{comment}{\#                  math.cos(alpha\_px -\/ alpha\_real)) * d\_pix / d\_real}}
\DoxyCodeLine{132 \textcolor{comment}{\#         offset = offset + np.array(points\_frame[i]) -\/ np.array((x\_new, y\_new))}}
\DoxyCodeLine{133 \textcolor{comment}{\#         \# print(alpha\_px*180/np.pi, alpha\_real*180/np.pi)}}
\DoxyCodeLine{134 \textcolor{comment}{\#         \# print((alpha\_px-\/alpha\_real)*180/np.pi)}}
\DoxyCodeLine{135 \textcolor{comment}{\#     \# Normalise magnification and angle}}
\DoxyCodeLine{136 \textcolor{comment}{\#     mag = mag / npoints}}
\DoxyCodeLine{137 \textcolor{comment}{\#     alpha = alpha / npoints}}
\DoxyCodeLine{138 \textcolor{comment}{\#     offset = offset / npoints}}
\DoxyCodeLine{139 \textcolor{comment}{\#     return mag, alpha, offset}}
\DoxyCodeLine{140 }
\DoxyCodeLine{141 }

\end{DoxyCode}
\mbox{\Hypertarget{namespaceLibMap_a15b8e38e11c7ebf83daf570394cd1b78}\label{namespaceLibMap_a15b8e38e11c7ebf83daf570394cd1b78}} 
\index{LibMap@{LibMap}!remap@{remap}}
\index{remap@{remap}!LibMap@{LibMap}}
\doxysubsubsection{\texorpdfstring{remap()}{remap()}}
{\footnotesize\ttfamily def Lib\+Map.\+remap (\begin{DoxyParamCaption}\item[{}]{smap,  }\item[{}]{timing = {\ttfamily True} }\end{DoxyParamCaption})}



Remap a frame. 

Jose Rueda\+: \href{mailto:jose.rueda@ipp.mpg.de}{\texttt{ jose.\+rueda@ipp.\+mpg.\+de}}


\begin{DoxyParams}{Parameters}
{\em smap} & Strike\+Map() object with the strike map \\
\hline
{\em timing} & Flag to time the routine or not \\
\hline
\end{DoxyParams}


Definition at line 261 of file Lib\+Map.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{261 \textcolor{keyword}{def }\mbox{\hyperlink{namespaceLibMap_a15b8e38e11c7ebf83daf570394cd1b78}{remap}}(smap, timing=True):}
\DoxyCodeLine{262     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{263 \textcolor{stringliteral}{    Remap a frame}}
\DoxyCodeLine{264 \textcolor{stringliteral}{}}
\DoxyCodeLine{265 \textcolor{stringliteral}{    Jose Rueda: jose.rueda@ipp.mpg.de}}
\DoxyCodeLine{266 \textcolor{stringliteral}{}}
\DoxyCodeLine{267 \textcolor{stringliteral}{    @param smap: StrikeMap() object with the strike map}}
\DoxyCodeLine{268 \textcolor{stringliteral}{    @param timing: Flag to time the routine or not}}
\DoxyCodeLine{269 \textcolor{stringliteral}{    "{}"{}"{}}}
\DoxyCodeLine{270     \textcolor{comment}{\# -\/-\/-\/ 0: Check inputs}}
\DoxyCodeLine{271     \textcolor{keywordflow}{if} smap.xpixel \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:}
\DoxyCodeLine{272         print(\textcolor{stringliteral}{'Please, transform to pixel the strike map before!!!'})}
\DoxyCodeLine{273         error = 1}
\DoxyCodeLine{274         \textcolor{keywordflow}{return} error, 0}
\DoxyCodeLine{275     }
\DoxyCodeLine{276     }
\DoxyCodeLine{277     \textcolor{keywordflow}{if} timing:}
\DoxyCodeLine{278         tic = time.time()}
\DoxyCodeLine{279 }
\DoxyCodeLine{280     }
\DoxyCodeLine{281 }
\DoxyCodeLine{282     \textcolor{keywordflow}{if} timing:}
\DoxyCodeLine{283         toc = time.time()}
\DoxyCodeLine{284         print(\textcolor{stringliteral}{'Elapsed time: '}, toc -\/ tic)}
\DoxyCodeLine{285 }
\DoxyCodeLine{286 }

\end{DoxyCode}
\mbox{\Hypertarget{namespaceLibMap_ac38fcf0ae779d053833f37492ef245c8}\label{namespaceLibMap_ac38fcf0ae779d053833f37492ef245c8}} 
\index{LibMap@{LibMap}!transform\_to\_pixel@{transform\_to\_pixel}}
\index{transform\_to\_pixel@{transform\_to\_pixel}!LibMap@{LibMap}}
\doxysubsubsection{\texorpdfstring{transform\_to\_pixel()}{transform\_to\_pixel()}}
{\footnotesize\ttfamily def Lib\+Map.\+transform\+\_\+to\+\_\+pixel (\begin{DoxyParamCaption}\item[{}]{x,  }\item[{}]{y,  }\item[{}]{grid\+\_\+param }\end{DoxyParamCaption})}



Transform from X,Y coordinates (points along the scintillator) to pixels in the camera. 

Jose Rueda Rueda\+: \href{mailto:jose.rueda@ipp.mpg.de}{\texttt{ jose.\+rueda@ipp.\+mpg.\+de}}


\begin{DoxyParams}{Parameters}
{\em x} & Array of positions to be transformed, x coordinate \\
\hline
{\em y} & Array of positions to be transformed, y coordinate \\
\hline
{\em grid\+\_\+param} & Object containing all the information for the transformation, see class Cal\+Params() \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
xpixel\+: x positions in pixels 

ypixel\+: y position in pixels 
\end{DoxyReturn}
\begin{DoxyRefDesc}{Todo}
\item[\mbox{\hyperlink{todo__todo000002}{Todo}}]Include a model to take into account the distortion\end{DoxyRefDesc}


Definition at line 15 of file Lib\+Map.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{15 \textcolor{keyword}{def }\mbox{\hyperlink{namespaceLibMap_ac38fcf0ae779d053833f37492ef245c8}{transform\_to\_pixel}}(x, y, grid\_param):}
\DoxyCodeLine{16     \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{17 \textcolor{stringliteral}{    Transform from X,Y coordinates (points along the scintillator) to pixels}}
\DoxyCodeLine{18 \textcolor{stringliteral}{    in the camera}}
\DoxyCodeLine{19 \textcolor{stringliteral}{}}
\DoxyCodeLine{20 \textcolor{stringliteral}{    Jose Rueda Rueda: jose.rueda@ipp.mpg.de}}
\DoxyCodeLine{21 \textcolor{stringliteral}{}}
\DoxyCodeLine{22 \textcolor{stringliteral}{    @param x: Array of positions to be transformed, x coordinate}}
\DoxyCodeLine{23 \textcolor{stringliteral}{    @param y: Array of positions to be transformed, y coordinate}}
\DoxyCodeLine{24 \textcolor{stringliteral}{    @param grid\_param: Object containing all the information for the}}
\DoxyCodeLine{25 \textcolor{stringliteral}{    transformation, see class CalParams()}}
\DoxyCodeLine{26 \textcolor{stringliteral}{    @return xpixel: x positions in pixels}}
\DoxyCodeLine{27 \textcolor{stringliteral}{    @return ypixel: y position in pixels}}
\DoxyCodeLine{28 \textcolor{stringliteral}{    @todo Include a model to take into account the distortion}}
\DoxyCodeLine{29 \textcolor{stringliteral}{    "{}"{}"{}}}
\DoxyCodeLine{30     alpha = grid\_param.deg * np.pi / 180}
\DoxyCodeLine{31     xpixel = (np.cos(alpha) * x -\/ np.sin(alpha) * y) * grid\_param.xscale + \(\backslash\)}
\DoxyCodeLine{32                 grid\_param.xshift}
\DoxyCodeLine{33     ypixel = (np.sin(alpha) * x + np.cos(alpha) * y) * grid\_param.yscale + \(\backslash\)}
\DoxyCodeLine{34                 grid\_param.yshift}
\DoxyCodeLine{35 }
\DoxyCodeLine{36     \textcolor{keywordflow}{return} xpixel, ypixel}
\DoxyCodeLine{37 }
\DoxyCodeLine{38 }

\end{DoxyCode}
