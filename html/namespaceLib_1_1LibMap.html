<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ScinSuite: Lib.LibMap Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ScinSuite
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
   <div id="projectbrief">Scintillator data Analysis</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceLib.html">Lib</a></li><li class="navelem"><a class="el" href="namespaceLib_1_1LibMap.html">LibMap</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Lib.LibMap Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Module to remap the scintillator.  
<a href="namespaceLib_1_1LibMap.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLib_1_1LibMap_1_1CalibrationDatabase.html">CalibrationDatabase</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Database of parameter to align the scintillator.  <a href="classLib_1_1LibMap_1_1CalibrationDatabase.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLib_1_1LibMap_1_1CalParams.html">CalParams</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Information to relate points in the camera sensor the scintillator.  <a href="classLib_1_1LibMap_1_1CalParams.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLib_1_1LibMap_1_1Scintillator.html">Scintillator</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Class with the scintillator information.  <a href="classLib_1_1LibMap_1_1Scintillator.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLib_1_1LibMap_1_1StrikeMap.html">StrikeMap</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Class with the information of the strike map.  <a href="classLib_1_1LibMap_1_1StrikeMap.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:af9b18fe42a615e2603fc26fe90159a4f"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceLib_1_1LibMap.html#af9b18fe42a615e2603fc26fe90159a4f">transform_to_pixel</a> (x, y, grid_param)</td></tr>
<tr class="memdesc:af9b18fe42a615e2603fc26fe90159a4f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Transform from X,Y coordinates (scintillator) to pixels in the camera.  <a href="namespaceLib_1_1LibMap.html#af9b18fe42a615e2603fc26fe90159a4f">More...</a><br /></td></tr>
<tr class="separator:af9b18fe42a615e2603fc26fe90159a4f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa43f909fadfa6b74f44d84a173e7d682"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceLib_1_1LibMap.html#aa43f909fadfa6b74f44d84a173e7d682">get_points</a> (fig, scintillator, bool plt_flag=True, int npoints=3)</td></tr>
<tr class="memdesc:aa43f909fadfa6b74f44d84a173e7d682"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the points of the scintillator via ginput method.  <a href="namespaceLib_1_1LibMap.html#aa43f909fadfa6b74f44d84a173e7d682">More...</a><br /></td></tr>
<tr class="separator:aa43f909fadfa6b74f44d84a173e7d682"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a94ccbdb5f047f2e11123c2bb720224d5"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceLib_1_1LibMap.html#a94ccbdb5f047f2e11123c2bb720224d5">calculate_transformation_factors</a> (scintillator, fig, bool plt_flag=True)</td></tr>
<tr class="memdesc:a94ccbdb5f047f2e11123c2bb720224d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the transformation factor to align the strike map.  <a href="namespaceLib_1_1LibMap.html#a94ccbdb5f047f2e11123c2bb720224d5">More...</a><br /></td></tr>
<tr class="separator:a94ccbdb5f047f2e11123c2bb720224d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6fe79b82b8fd6969ac96fe3723bd8149"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceLib_1_1LibMap.html#a6fe79b82b8fd6969ac96fe3723bd8149">remap</a> (smap, frame, x_min=20.0, x_max=80.0, delta_x=1, y_min=1.5, y_max=10.0, delta_y=0.2, timing=True)</td></tr>
<tr class="memdesc:a6fe79b82b8fd6969ac96fe3723bd8149"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remap a frame.  <a href="namespaceLib_1_1LibMap.html#a6fe79b82b8fd6969ac96fe3723bd8149">More...</a><br /></td></tr>
<tr class="separator:a6fe79b82b8fd6969ac96fe3723bd8149"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad05561d8fdbe64c2407dea6ad2822854"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceLib_1_1LibMap.html#ad05561d8fdbe64c2407dea6ad2822854">gyr_profile</a> (remap_frame, pitch_centers, float min_pitch, float max_pitch, bool verbose=False)</td></tr>
<tr class="memdesc:ad05561d8fdbe64c2407dea6ad2822854"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cut the FILD signal to get a profile along gyroradius.  <a href="namespaceLib_1_1LibMap.html#ad05561d8fdbe64c2407dea6ad2822854">More...</a><br /></td></tr>
<tr class="separator:ad05561d8fdbe64c2407dea6ad2822854"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97a7a5bf94c7b97b8aff96943f8b802f"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceLib_1_1LibMap.html#a97a7a5bf94c7b97b8aff96943f8b802f">pitch_profile</a> (remap_frame, gyr_centers, float min_gyr, float max_gyr, verbose=False)</td></tr>
<tr class="memdesc:a97a7a5bf94c7b97b8aff96943f8b802f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cut the FILD signal to get a profile along pitch.  <a href="namespaceLib_1_1LibMap.html#a97a7a5bf94c7b97b8aff96943f8b802f">More...</a><br /></td></tr>
<tr class="separator:a97a7a5bf94c7b97b8aff96943f8b802f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acab45b0c4f9727baad73475231884fc7"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceLib_1_1LibMap.html#acab45b0c4f9727baad73475231884fc7">get_energy_FILD</a> (gyroradius, float B, int A=2, int Z=1)</td></tr>
<tr class="memdesc:acab45b0c4f9727baad73475231884fc7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Relate the gyroradius with the associated energy (FILDSIM definition)  <a href="namespaceLib_1_1LibMap.html#acab45b0c4f9727baad73475231884fc7">More...</a><br /></td></tr>
<tr class="separator:acab45b0c4f9727baad73475231884fc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Module to remap the scintillator. </p>
<p>It contains the routines to load and aling the strike maps, as well as perform the remapping </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a94ccbdb5f047f2e11123c2bb720224d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a94ccbdb5f047f2e11123c2bb720224d5">&#9670;&nbsp;</a></span>calculate_transformation_factors()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def Lib.LibMap.calculate_transformation_factors </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>scintillator</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &#160;</td>
          <td class="paramname"><em>plt_flag</em> = <code>True</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate the transformation factor to align the strike map. </p>
<p>Jose Rueda: <a href="#" onclick="location.href='mai'+'lto:'+'jos'+'e.'+'rue'+'da'+'@ip'+'p.'+'mpg'+'.d'+'e'; return false;">jose.<span style="display: none;">.nosp@m.</span>rued<span style="display: none;">.nosp@m.</span>a@ipp<span style="display: none;">.nosp@m.</span>.mpg<span style="display: none;">.nosp@m.</span>.de</a></p>
<p>Calculate the transformation factor to align the strike map with the camera sensor. It ask for the user to select some points in the scintillator and to select the same points in the calibration file</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">scintillator</td><td><a class="el" href="classLib_1_1LibMap_1_1Scintillator.html" title="Class with the scintillator information.">Scintillator</a> object </td></tr>
    <tr><td class="paramname">fig</td><td>figure where the calibration image is drawn </td></tr>
    <tr><td class="paramname">plt_flag</td><td>flag to plot the selected points to align the scintillator </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>xmag: magnification factor in the x direction to align strike map </dd>
<dd>
mag: magnification factor in the y direction </dd>
<dd>
alpha: rotation angle to orientate the strike map </dd>
<dd>
offset: offset to place the strike map </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000004">Todo:</a></b></dt><dd>check with a non inverted png if the minus I included to align the scintillator is needed or not</dd></dl>

<p class="definition">Definition at line <a class="el" href="LibMap_8py_source.html#l00141">141</a> of file <a class="el" href="LibMap_8py_source.html">LibMap.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceLib_1_1LibMap.html#a94ccbdb5f047f2e11123c2bb720224d5">calculate_transformation_factors</a>(scintillator, fig, plt_flag: bool = <span class="keyword">True</span>):</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="stringliteral">    Calculate the transformation factor to align the strike map</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="stringliteral">    Jose Rueda: jose.rueda@ipp.mpg.de</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="stringliteral">    Calculate the transformation factor to align the strike map with the</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="stringliteral">    camera sensor. It ask for the user to select some points in the</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="stringliteral">    scintillator and to select the same points in the calibration file</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="stringliteral">    @param scintillator: Scintillator object</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="stringliteral">    @param fig: figure where the calibration image is drawn</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="stringliteral">    @param plt_flag: flag to plot the selected points to align the scintillator</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="stringliteral">    @return xmag: magnification factor in the x direction to align strike map</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="stringliteral">    @return mag: magnification factor in the y direction</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="stringliteral">    @return alpha: rotation angle to orientate the strike map</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="stringliteral">    @return offset: offset to place the strike map</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="stringliteral">    @todo check with a non inverted png if the minus I included to align the</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="stringliteral">    scintillator is needed or not</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="comment"># Plot the scintillator</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    fig_scint, ax_scint = plt.subplots()</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    scintillator.plot_real(ax_scint)</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment"># Select the points in the scintillator</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    index = <a class="code" href="namespaceLib_1_1LibMap.html#aa43f909fadfa6b74f44d84a173e7d682">get_points</a>(fig_scint, scintillator, plt_flag)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    npoints = index.size</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    print(npoints)</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment"># Select the corresponding points in the reference frame</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    print(<span class="stringliteral">&#39;Select the points on the calibration frame, in the same order as &#39;</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;          <span class="stringliteral">&#39;before&#39;</span>)</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    points_frame = fig.ginput(npoints)</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    print(points_frame)</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment"># Define the vectors which will give us the reference</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    v21_real = np.array((scintillator.coord_real[index[0], 1] -</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                         scintillator.coord_real[index[1], 1],</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                         scintillator.coord_real[index[0], 2] -</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                         scintillator.coord_real[index[1], 2], 0))</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    v23_real = np.array((scintillator.coord_real[index[2], 1] -</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                         scintillator.coord_real[index[1], 1],</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                         scintillator.coord_real[index[2], 2] -</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                         scintillator.coord_real[index[1], 2], 0))</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    print(v21_real)</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    print(points_frame[0][0])</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    a = np.array((points_frame[0][0], points_frame[0][1], 0))</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    print(a)</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    print(a.shape)</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160; </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    v21_pix = np.array([points_frame[0][0], points_frame[0][1], 0]) - \</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        np.array([points_frame[1][0], points_frame[1][1], 0])</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160; </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    v23_pix = np.array([points_frame[2][0], points_frame[2][1], 0]) - \</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        np.array([points_frame[1][0], points_frame[1][1], 0])</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160; </div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="comment"># See if an inversion of one of the axis is needed or not.</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    normal_real = np.cross(v21_real, v23_real)</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    print(normal_real)</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    normal_pix = np.cross(v21_pix, v23_pix)</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    print(normal_pix)</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment"># If the normals has opposite signs, an inversion must be done</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">if</span> normal_pix[2] * normal_real[2] &lt; 0:</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        sign = -1.0</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        sign = 1.0</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="comment"># With this sign in mind, now we can proceed with the calculation of the</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment"># ratio and the gyration angle</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment"># Initialise the variables</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    alpha = 0  <span class="comment"># Rotation to be applied</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    mag = 0  <span class="comment"># Magnification</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    offset = np.zeros(2)</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(npoints):</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="comment"># We will use the pair formed by each point and the following,</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="comment"># for the case of the last point in the list, just take the next one</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        i2 = i + 1</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keywordflow">if</span> i2 == npoints:</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            i2 = 0</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="comment"># Distance in the real scintillator</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        d_real = np.sqrt((scintillator.coord_real[index[i], 2] -</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                          scintillator.coord_real[index[i2], 2]) ** 2 +</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                         (scintillator.coord_real[index[i], 1] -</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                          scintillator.coord_real[index[i2], 1]) ** 2)</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="comment"># Distance in the sensor</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        dummy = np.array(points_frame[i]) - np.array(points_frame[i2])</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        d_pix = np.sqrt(dummy[1] ** 2 + dummy[0] ** 2)</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="comment"># Cumulate the magnification factor (we will normalise at the end)</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        mag = mag + d_pix / d_real</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="comment"># Calculate the angles</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        alpha_r = -  math.atan2(scintillator.coord_real[index[i], 2] -</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                                scintillator.coord_real[index[i2], 2],</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                                sign * scintillator.coord_real[index[i], 1] -</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                                sign * scintillator.coord_real[index[i2], 1])</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="comment"># If alpha == 180, it can be also -180, atan2 fails here, check which</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="comment"># one is the case</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordflow">if</span> int(alpha_r * 180 / np.pi) == 180:</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            print(<span class="stringliteral">&#39;Correcting angle&#39;</span>)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            <span class="keywordflow">if</span> scintillator.coord_real[index[i2], 1] &gt; scintillator.coord_real[</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                                                        index[i], 1]:</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                alpha_r = - alpha_r</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        alpha_px = - math.atan2(dummy[1], dummy[0])</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        alpha = alpha + (alpha_px - alpha_r)</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="comment"># Transform the coordinate to estimate the offset</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        x_new = (scintillator.coord_real[index[i], 1] *</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                 math.cos(alpha_px - alpha_r) -</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                 scintillator.coord_real[index[i], 2] *</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                 math.sin(alpha_px - alpha_r)) * d_pix / d_real * sign</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        y_new = (scintillator.coord_real[index[i], 1] *</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                 math.sin(alpha_px - alpha_r) +</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                 scintillator.coord_real[index[i], 2] *</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                 math.cos(alpha_px - alpha_r)) * d_pix / d_real</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        offset = offset + np.array(points_frame[i]) - np.array((x_new, y_new))</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="comment"># print(alpha_px*180/np.pi, alpha_real*180/np.pi)</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="comment"># print((alpha_px-alpha_real)*180/np.pi)</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="comment"># Normalise magnification and angle</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    mag = mag / npoints</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    xmag = sign * mag</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    alpha = alpha / npoints * 180 / np.pi</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    offset = offset / npoints</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordflow">return</span> xmag, mag, alpha, offset[0], offset[1]</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160; </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="acab45b0c4f9727baad73475231884fc7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acab45b0c4f9727baad73475231884fc7">&#9670;&nbsp;</a></span>get_energy_FILD()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def Lib.LibMap.get_energy_FILD </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>gyroradius</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>B</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &#160;</td>
          <td class="paramname"><em>A</em> = <code>2</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &#160;</td>
          <td class="paramname"><em>Z</em> = <code>1</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Relate the gyroradius with the associated energy (FILDSIM definition) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">gyroradius</td><td>Larmor radius as taken from FILD strike map [in cm] </td></tr>
    <tr><td class="paramname">B</td><td>Magnetc field, [in T] </td></tr>
    <tr><td class="paramname">A</td><td>Ion mass number </td></tr>
    <tr><td class="paramname">Z</td><td>Ion charge [in e units] </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>E: the energy [in eV] </dd></dl>

<p class="definition">Definition at line <a class="el" href="LibMap_8py_source.html#l00400">400</a> of file <a class="el" href="LibMap_8py_source.html">LibMap.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceLib_1_1LibMap.html#acab45b0c4f9727baad73475231884fc7">get_energy_FILD</a>(gyroradius, B: float, A: int = 2, Z: int = 1):</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="stringliteral">    Relate the gyroradius with the associated energy (FILDSIM definition)</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="stringliteral">    @param gyroradius: Larmor radius as taken from FILD strike map [in cm]</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="stringliteral">    @param B: Magnetc field, [in T]</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="stringliteral">    @param A: Ion mass number</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="stringliteral">    @param Z: Ion charge [in e units]</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="stringliteral">    @return E: the energy [in eV]</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    m = ssp.mp * A  <span class="comment"># Mass of the ion</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    E = 0.5 * (gyroradius/100.0 * Z * B)**2 / m * ssp.c ** 2</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordflow">return</span> E</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="aa43f909fadfa6b74f44d84a173e7d682"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa43f909fadfa6b74f44d84a173e7d682">&#9670;&nbsp;</a></span>get_points()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def Lib.LibMap.get_points </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>scintillator</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &#160;</td>
          <td class="paramname"><em>plt_flag</em> = <code>True</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &#160;</td>
          <td class="paramname"><em>npoints</em> = <code>3</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the points of the scintillator via ginput method. </p>
<p>Jose Rueda: <a href="#" onclick="location.href='mai'+'lto:'+'jos'+'e.'+'rue'+'da'+'@ip'+'p.'+'mpg'+'.d'+'e'; return false;">jose.<span style="display: none;">.nosp@m.</span>rued<span style="display: none;">.nosp@m.</span>a@ipp<span style="display: none;">.nosp@m.</span>.mpg<span style="display: none;">.nosp@m.</span>.de</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fig</td><td>Axis where the scintillator is drawn </td></tr>
    <tr><td class="paramname">scintillator</td><td><a class="el" href="classLib_1_1LibMap_1_1Scintillator.html" title="Class with the scintillator information.">Scintillator</a> object </td></tr>
    <tr><td class="paramname">plt_flag</td><td>flag to plot </td></tr>
    <tr><td class="paramname">npoints</td><td>number of points in the selection </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>index: array with the index of each point, to be located in the scintillator.coord_real </dd></dl>

<p class="definition">Definition at line <a class="el" href="LibMap_8py_source.html#l00038">38</a> of file <a class="el" href="LibMap_8py_source.html">LibMap.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceLib_1_1LibMap.html#aa43f909fadfa6b74f44d84a173e7d682">get_points</a>(fig, scintillator, plt_flag: bool = <span class="keyword">True</span>, npoints: int = 3):</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="stringliteral">    Get the points of the scintillator via ginput method</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="stringliteral">    Jose Rueda: jose.rueda@ipp.mpg.de</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="stringliteral">    @param fig: Axis where the scintillator is drawn</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="stringliteral">    @param scintillator: Scintillator object</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="stringliteral">    @param plt_flag: flag to plot</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="stringliteral">    @param npoints: number of points in the selection</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="stringliteral">    @return index: array with the index of each point, to be located in the</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="stringliteral">    scintillator.coord_real</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    print(<span class="stringliteral">&#39;Select the points in the scintillator&#39;</span>)</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    points = fig.ginput(npoints)</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    index = np.zeros(npoints, dtype=int)</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(npoints):</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        relative_pos = scintillator.coord_real[:, 1:3] - points[i]</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        <span class="comment"># print(relative_pos)</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        index[i] = int(</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;            np.argmin(relative_pos[:, 1] ** 2 + relative_pos[:, 0] ** 2))</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="comment"># print(index[i])</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="keywordflow">if</span> plt_flag:</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;            plt.plot(scintillator.coord_real[index[i], 1],</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                     scintillator.coord_real[index[i], 2], <span class="stringliteral">&#39;o&#39;</span>)</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            plt.text(scintillator.coord_real[index[i], 1],</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                     scintillator.coord_real[index[i], 2], str(i + 1))</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">return</span> index</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160; </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment"># def transformation_factors(index, scintillator, fig): DEPRECATED</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">#     &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">#     Calculate the factor to translate from points in the scintillator to</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">#     pixels in the camera</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">#     Jose Rueda: jose.rueda@ipp.mpg.de</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">#     @param index: index array generated by get_points()</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">#     @param scintillator: Scintillator object</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">#     @param fig: the figure where the calibration image is plotted</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">#     @return:</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">#     &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">#     # Number of points to be used</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">#     npoints = index.size</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">#     # Point on the calibration frame</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">#     print(&#39;Select the points on the calibration frame, in the same order as &#39;</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">#           &#39;before&#39;)</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">#     points_frame = fig.ginput(npoints)</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">#     # Initialise the variables</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">#     alpha = 0  # Rotation to be applied</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">#     mag = 0  # Magnification</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">#     offset = np.zeros(2)</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">#     for i in range(npoints):</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">#         # We will use the pair formed by each point and the following,</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">#         # for the case of the last point in the list, just take the next one</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">#         i2 = i + 1</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">#         if i2 == npoints:</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">#             i2 = 0</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">#         # Distance in the real scintillator</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">#         d_real = np.sqrt((scintillator.coord_real[index[i], 2] -</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">#                           scintillator.coord_real[index[i2], 2]) ** 2 +</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">#                          (scintillator.coord_real[index[i], 1] -</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">#                           scintillator.coord_real[index[i2], 1]) ** 2)</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">#         # Distance in the sensor</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">#         dummy = np.array(points_frame[i]) - np.array(points_frame[i2])</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">#         d_pix = np.sqrt(dummy[1] ** 2 + dummy[0] ** 2)</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">#         # Cumulate the magnification factor (we will normalise at the end)</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">#         mag = mag + d_pix / d_real</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">#         # Calculate the angles</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">#         alpha_real = math.atan2(scintillator.coord_real[index[i], 2] -</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">#                                 scintillator.coord_real[index[i2], 2],</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">#                                 scintillator.coord_real[index[i], 1] -</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">#                                 scintillator.coord_real[index[i2], 1])</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">#         # If alpha == 180, it can be also -180, atan2 fails here, check which</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">#         # one is the case</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">#         if int(alpha_real * 180 / np.pi) == 180:</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">#             print(&#39;Correcting angle&#39;)</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">#             if scintillator.coord_real[index[i2],</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">#                                        1] &gt; scintillator.coord_real[</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">#                 index[i], 1]:</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">#                 alpha_real = - alpha_real</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">#         alpha_px = math.atan2(dummy[1], dummy[0])</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">#         alpha = alpha + (alpha_px - alpha_real)</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">#         # Transform the coordinate to estimate the offset</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">#         x_new = (scintillator.coord_real[index[i], 1] *</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">#                  math.cos(alpha_px - alpha_real) -</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">#                  scintillator.coord_real[index[i], 2] *</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">#                  math.sin(alpha_px - alpha_real)) * d_pix / d_real</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">#         y_new = (scintillator.coord_real[index[i], 1] *</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">#                  math.sin(alpha_px - alpha_real) +</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">#                  scintillator.coord_real[index[i], 2] *</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">#                  math.cos(alpha_px - alpha_real)) * d_pix / d_real</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">#         offset = offset + np.array(points_frame[i]) -np.array((x_new, y_new))</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">#         # print(alpha_px*180/np.pi, alpha_real*180/np.pi)</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">#         # print((alpha_px-alpha_real)*180/np.pi)</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">#     # Normalise magnification and angle</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">#     mag = mag / npoints</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">#     alpha = alpha / npoints</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">#     offset = offset / npoints</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">#     return mag, alpha, offset</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="ad05561d8fdbe64c2407dea6ad2822854"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad05561d8fdbe64c2407dea6ad2822854">&#9670;&nbsp;</a></span>gyr_profile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def Lib.LibMap.gyr_profile </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>remap_frame</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>pitch_centers</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>min_pitch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>max_pitch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &#160;</td>
          <td class="paramname"><em>verbose</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Cut the FILD signal to get a profile along gyroradius. </p>
<dl class="section author"><dt>Author</dt><dd>: Jose Rueda: <a href="#" onclick="location.href='mai'+'lto:'+'jos'+'e.'+'rue'+'da'+'@ip'+'p.'+'mpg'+'.d'+'e'; return false;">jose.<span style="display: none;">.nosp@m.</span>rued<span style="display: none;">.nosp@m.</span>a@ipp<span style="display: none;">.nosp@m.</span>.mpg<span style="display: none;">.nosp@m.</span>.de</a></dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">remap_frame</td><td>np.array with the remapped frame @type: ndarray</td></tr>
    <tr><td class="paramname">pitch_centers</td><td>np array produced by the remap function @type: ndarray</td></tr>
    <tr><td class="paramname">min_pitch</td><td>minimum pitch to include @type: float</td></tr>
    <tr><td class="paramname">max_pitch</td><td>Maximum pitch to include @type: float</td></tr>
    <tr><td class="paramname">verbose</td><td>if true, the actual pitch interval will be printed @type: bool</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>: Description of returned object. @rtype: type</dd></dl>
<p>@raises ExceptionName: exception if the desired pitch range is not in the frame </p>

<p class="definition">Definition at line <a class="el" href="LibMap_8py_source.html#l00306">306</a> of file <a class="el" href="LibMap_8py_source.html">LibMap.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                max_pitch: float, verbose: bool = <span class="keyword">False</span>):</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="stringliteral">    Cut the FILD signal to get a profile along gyroradius</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="stringliteral">    @author:  Jose Rueda: jose.rueda@ipp.mpg.de</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="stringliteral">    @param    remap_frame: np.array with the remapped frame</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="stringliteral">    @type:    ndarray</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="stringliteral">    @param    pitch_centers: np array produced by the remap function</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="stringliteral">    @type:    ndarray</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="stringliteral">    @param    min_pitch: minimum pitch to include</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="stringliteral">    @type:    float</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="stringliteral">    @param    max_pitch: Maximum pitch to include</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="stringliteral">    @type:    float</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="stringliteral">    @param    verbose: if true, the actual pitch interval will be printed</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="stringliteral">    @type:    bool</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="stringliteral">    @return:  Description of returned object.</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="stringliteral">    @rtype:   type</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="stringliteral">    @raises   ExceptionName: exception if the desired pitch range is not in the</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="stringliteral">    frame</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="comment"># See which cells do we need</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    flags = (pitch_centers &lt; max_pitch) * (pitch_centers &gt; min_pitch)</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordflow">if</span> np.sum(flags) == 0:</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;No single cell satisfy the condition!&#39;</span>)</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="comment"># The pitch centers is the centroid of the cell, but a cell include counts</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="comment"># which pitchs are in [p0-dp, p0+dp], therefore, let give to the user these</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="comment"># to values</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    used_pitches = pitch_centers[flags]</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    delta = pitch_centers[1] - pitch_centers[0]</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    min_used_pitch = used_pitches[0] - 0.5 * delta</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    max_used_pitch = used_pitches[-1] + 0.5 * delta</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    dummy = remap_frame[flags, :]</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    profile = np.sum(dummy, axis=0)</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">if</span> verbose:</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        print(<span class="stringliteral">&#39;The minimum pitch used is: &#39;</span>, min_used_pitch)</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        print(<span class="stringliteral">&#39;The Maximum pitch used is: &#39;</span>, max_used_pitch)</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordflow">return</span> profile</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160; </div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="a97a7a5bf94c7b97b8aff96943f8b802f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a97a7a5bf94c7b97b8aff96943f8b802f">&#9670;&nbsp;</a></span>pitch_profile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def Lib.LibMap.pitch_profile </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>remap_frame</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>gyr_centers</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>min_gyr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>max_gyr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>verbose</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Cut the FILD signal to get a profile along pitch. </p>
<dl class="section author"><dt>Author</dt><dd>: Jose Rueda: <a href="#" onclick="location.href='mai'+'lto:'+'jos'+'e.'+'rue'+'da'+'@ip'+'p.'+'mpg'+'.d'+'e'; return false;">jose.<span style="display: none;">.nosp@m.</span>rued<span style="display: none;">.nosp@m.</span>a@ipp<span style="display: none;">.nosp@m.</span>.mpg<span style="display: none;">.nosp@m.</span>.de</a></dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">remap_frame</td><td>np.array with the remapped frame @type: ndarray</td></tr>
    <tr><td class="paramname">gyr_centers</td><td>np array produced by the remap function @type: ndarray</td></tr>
    <tr><td class="paramname">min_gyr</td><td>minimum pitch to include @type: float</td></tr>
    <tr><td class="paramname">max_gyr</td><td>Maximum pitch to include @type: float</td></tr>
    <tr><td class="paramname">verbose</td><td>if true, the actual pitch interval will be printed @type: bool</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>: Description of returned object. @rtype: type</dd></dl>
<p>@raises ExceptionName: exception if the desired gyroradius range is not in the frame </p>

<p class="definition">Definition at line <a class="el" href="LibMap_8py_source.html#l00353">353</a> of file <a class="el" href="LibMap_8py_source.html">LibMap.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                  max_gyr: float, verbose=<span class="keyword">False</span>):</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="stringliteral">    Cut the FILD signal to get a profile along pitch</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="stringliteral">    @author:  Jose Rueda: jose.rueda@ipp.mpg.de</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="stringliteral">    @param    remap_frame: np.array with the remapped frame</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="stringliteral">    @type:    ndarray</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="stringliteral">    @param    gyr_centers: np array produced by the remap function</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="stringliteral">    @type:    ndarray</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="stringliteral">    @param    min_gyr: minimum pitch to include</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="stringliteral">    @type:    float</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="stringliteral">    @param    max_gyr: Maximum pitch to include</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="stringliteral">    @type:    float</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="stringliteral">    @param    verbose: if true, the actual pitch interval will be printed</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="stringliteral">    @type:    bool</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="stringliteral">    @return:  Description of returned object.</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="stringliteral">    @rtype:   type</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="stringliteral">    @raises   ExceptionName: exception if the desired gyroradius range is not</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="stringliteral">    in the frame</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="comment"># See which cells do we need</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    flags = (gyr_centers &lt; max_gyr) * (gyr_centers &gt; min_gyr)</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordflow">if</span> np.sum(flags) == 0:</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;No single cell satisfy the condition!&#39;</span>)</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="comment"># The pitch centers is the centroid of the cell, but a cell include counts</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="comment"># which pitchs are in [p0-dp, p0+dp], therefore, let give to the user these</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="comment"># to values</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    used_gyr = gyr_centers[flags]</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    delta = gyr_centers[1] - gyr_centers[0]</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    min_used_gyr = used_gyr[0] - 0.5 * delta</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    max_used_gyr = used_gyr[-1] + 0.5 * delta</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    dummy = remap_frame[:, flags]</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    profile = np.sum(dummy, axis=1)</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordflow">if</span> verbose:</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        print(<span class="stringliteral">&#39;The minimum gyroradius used is: &#39;</span>, min_used_gyr)</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        print(<span class="stringliteral">&#39;The Maximum gyroradius used is: &#39;</span>, max_used_gyr)</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordflow">return</span> profile</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="a6fe79b82b8fd6969ac96fe3723bd8149"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6fe79b82b8fd6969ac96fe3723bd8149">&#9670;&nbsp;</a></span>remap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def Lib.LibMap.remap </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>smap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>frame</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>x_min</em> = <code>20.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>x_max</em> = <code>80.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>delta_x</em> = <code>1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>y_min</em> = <code>1.5</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>y_max</em> = <code>10.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>delta_y</em> = <code>0.2</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>timing</em> = <code>True</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remap a frame. </p>
<p>Jose Rueda: <a href="#" onclick="location.href='mai'+'lto:'+'jos'+'e.'+'rue'+'da'+'@ip'+'p.'+'mpg'+'.d'+'e'; return false;">jose.<span style="display: none;">.nosp@m.</span>rued<span style="display: none;">.nosp@m.</span>a@ipp<span style="display: none;">.nosp@m.</span>.mpg<span style="display: none;">.nosp@m.</span>.de</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">smap</td><td>StrikeMap() object with the strike map </td></tr>
    <tr><td class="paramname">frame</td><td>the frame to be remapped </td></tr>
    <tr><td class="paramname">x_min</td><td>Minimum value of the x coordinate, for FILD, pitch [] </td></tr>
    <tr><td class="paramname">x_max</td><td>Maximum value of the x coordinate </td></tr>
    <tr><td class="paramname">delta_x</td><td>Spacing for the x coordinate </td></tr>
    <tr><td class="paramname">y_min</td><td>Minimim value of the y coordinate, for FILD, gyroradius [cm] </td></tr>
    <tr><td class="paramname">y_max</td><td>Maximum value of the y coordinate </td></tr>
    <tr><td class="paramname">delta_x</td><td>Spacing of the y coordinate </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="LibMap_8py_source.html#l00262">262</a> of file <a class="el" href="LibMap_8py_source.html">LibMap.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;          y_min=1.5, y_max=10.0, delta_y=0.2, timing=<span class="keyword">True</span>):</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="stringliteral">    Remap a frame</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="stringliteral">    Jose Rueda: jose.rueda@ipp.mpg.de</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="stringliteral">    @param smap: StrikeMap() object with the strike map</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="stringliteral">    @param frame: the frame to be remapped</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="stringliteral">    @param x_min: Minimum value of the x coordinate, for FILD, pitch []</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="stringliteral">    @param x_max: Maximum value of the x coordinate</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="stringliteral">    @param delta_x: Spacing for the x coordinate</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="stringliteral">    @param y_min: Minimim value of the y coordinate, for FILD, gyroradius [cm]</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="stringliteral">    @param y_max: Maximum value of the y coordinate</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="stringliteral">    @param delta_x: Spacing of the y coordinate</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="comment"># --- 0: Check inputs</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">if</span> smap.gyr_interp <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        print(<span class="stringliteral">&#39;Please, transform to pixel the strike map before!!!&#39;</span>)</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="keywordflow">return</span> 0, 0, 0</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160; </div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment"># --- 1: Edges of the histogram</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    x_edges = np.arange(start=x_min, stop=x_max, step=delta_x)</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    y_edges = np.arange(start=y_min, stop=y_max, step=delta_y)</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="comment"># --- 2: Information of the calibration</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">if</span> smap.diag == <span class="stringliteral">&#39;FILD&#39;</span>:</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        x = smap.pit_interp.flatten()   <span class="comment"># pitch associated to each pixel</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        y = smap.gyr_interp.flatten()   <span class="comment"># gyroradius associated to each pixel</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160; </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="comment"># --- 3: Remap (via histogram)</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    z = frame.flatten()</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    H, xedges, yedges = np.histogram2d(x, y, bins=[x_edges, y_edges],</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                                       weights=z)</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="comment"># Normalise H to counts per unit of each axis</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    H /= delta_x * delta_y</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="comment"># --- 4: Calculate the centroids of the bins, for later plotting</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    x_cen = 0.5 * (x_edges[0:-1] + x_edges[1:])</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    y_cen = 0.5 * (y_edges[0:-1] + y_edges[1:])</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160; </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">return</span> H, x_cen, y_cen</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="af9b18fe42a615e2603fc26fe90159a4f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9b18fe42a615e2603fc26fe90159a4f">&#9670;&nbsp;</a></span>transform_to_pixel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def Lib.LibMap.transform_to_pixel </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>grid_param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Transform from X,Y coordinates (scintillator) to pixels in the camera. </p>
<p>Jose Rueda Rueda: <a href="#" onclick="location.href='mai'+'lto:'+'jos'+'e.'+'rue'+'da'+'@ip'+'p.'+'mpg'+'.d'+'e'; return false;">jose.<span style="display: none;">.nosp@m.</span>rued<span style="display: none;">.nosp@m.</span>a@ipp<span style="display: none;">.nosp@m.</span>.mpg<span style="display: none;">.nosp@m.</span>.de</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">x</td><td>Array of positions to be transformed, x coordinate </td></tr>
    <tr><td class="paramname">y</td><td>Array of positions to be transformed, y coordinate </td></tr>
    <tr><td class="paramname">grid_param</td><td>Object containing all the information for the transformation, see class CalParams() </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>xpixel: x positions in pixels </dd>
<dd>
ypixel: y position in pixels </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000003">Todo:</a></b></dt><dd>Include a model to take into account the distortion</dd></dl>

<p class="definition">Definition at line <a class="el" href="LibMap_8py_source.html#l00015">15</a> of file <a class="el" href="LibMap_8py_source.html">LibMap.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceLib_1_1LibMap.html#af9b18fe42a615e2603fc26fe90159a4f">transform_to_pixel</a>(x, y, grid_param):</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="stringliteral">    Transform from X,Y coordinates (scintillator) to pixels in the camera</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="stringliteral">    Jose Rueda Rueda: jose.rueda@ipp.mpg.de</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="stringliteral">    @param x: Array of positions to be transformed, x coordinate</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="stringliteral">    @param y: Array of positions to be transformed, y coordinate</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="stringliteral">    @param grid_param: Object containing all the information for the</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="stringliteral">    transformation, see class CalParams()</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="stringliteral">    @return xpixel: x positions in pixels</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="stringliteral">    @return ypixel: y position in pixels</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="stringliteral">    @todo Include a model to take into account the distortion</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    alpha = grid_param.deg * np.pi / 180</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    xpixel = (np.cos(alpha) * x - np.sin(alpha) * y) * grid_param.xscale + \</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        grid_param.xshift</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    ypixel = (np.sin(alpha) * x + np.cos(alpha) * y) * grid_param.yscale + \</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        grid_param.yshift</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordflow">return</span> xpixel, ypixel</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<div class="ttc" id="anamespaceLib_1_1LibMap_html_acab45b0c4f9727baad73475231884fc7"><div class="ttname"><a href="namespaceLib_1_1LibMap.html#acab45b0c4f9727baad73475231884fc7">Lib.LibMap.get_energy_FILD</a></div><div class="ttdeci">def get_energy_FILD(gyroradius, float B, int A=2, int Z=1)</div><div class="ttdoc">Relate the gyroradius with the associated energy (FILDSIM definition)</div><div class="ttdef"><b>Definition:</b> <a href="LibMap_8py_source.html#l00400">LibMap.py:400</a></div></div>
<div class="ttc" id="anamespaceLib_1_1LibMap_html_aa43f909fadfa6b74f44d84a173e7d682"><div class="ttname"><a href="namespaceLib_1_1LibMap.html#aa43f909fadfa6b74f44d84a173e7d682">Lib.LibMap.get_points</a></div><div class="ttdeci">def get_points(fig, scintillator, bool plt_flag=True, int npoints=3)</div><div class="ttdoc">Get the points of the scintillator via ginput method.</div><div class="ttdef"><b>Definition:</b> <a href="LibMap_8py_source.html#l00038">LibMap.py:38</a></div></div>
<div class="ttc" id="anamespaceLib_1_1LibMap_html_a94ccbdb5f047f2e11123c2bb720224d5"><div class="ttname"><a href="namespaceLib_1_1LibMap.html#a94ccbdb5f047f2e11123c2bb720224d5">Lib.LibMap.calculate_transformation_factors</a></div><div class="ttdeci">def calculate_transformation_factors(scintillator, fig, bool plt_flag=True)</div><div class="ttdoc">Calculate the transformation factor to align the strike map.</div><div class="ttdef"><b>Definition:</b> <a href="LibMap_8py_source.html#l00141">LibMap.py:141</a></div></div>
<div class="ttc" id="anamespaceLib_1_1LibMap_html_af9b18fe42a615e2603fc26fe90159a4f"><div class="ttname"><a href="namespaceLib_1_1LibMap.html#af9b18fe42a615e2603fc26fe90159a4f">Lib.LibMap.transform_to_pixel</a></div><div class="ttdeci">def transform_to_pixel(x, y, grid_param)</div><div class="ttdoc">Transform from X,Y coordinates (scintillator) to pixels in the camera.</div><div class="ttdef"><b>Definition:</b> <a href="LibMap_8py_source.html#l00015">LibMap.py:15</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.0
</small></address>
</body>
</html>
